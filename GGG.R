library(TSA)
library(fpp)
library(fGarch)
stock <- read.csv("game.csv", header=T)
dim(stock)
stock <- ts(stock)
plot(stock, main="Time Series of Stock Prices")
acf(stock)
#??????平穩???
BC=BoxCox.ar(stock, lambda = seq(-5, 5))
plot(log(stock), main="Time Series of Stock Prices (with log)")
acf(log(stock))
pacf(log(stock))
#???平穩???檢???(????????????))
kpss.test(log(stock))#不??????H0
adf.test(log(stock))#??????H0

plot(diff(log(stock)), main="Time Series of Stock Prices (with log return)")
acf(diff(log(stock)))
pacf(diff(log(stock)))
eacf(diff(log(stock)))
#???平穩???檢???(????????????))
kpss.test(diff(log(stock)))#不??????H0
adf.test(diff(log(stock)))#??????H0

#=====================================
###???置模???MA(1)
#要放mu???去估???
mod1 <- arima(diff(log(stock)), order=c(0, 0, 1), include.mean=F)
res1 <- residuals(mod1)
plot(res1, main="Residual Plot of IMA(1,1)")
acf(res1, main="Residual ACF of IMA(1,1)")
summary(mod1)
#Ljung box lag=2, 3, 21, 27,...
Box.test(res1, lag=5, type="Ljung-Box") #不??????->不相???
#檢???平???
hist(res1, main="Histogram of residual (IMA(1,1))")
t.test(res1)
#檢???normal
shapiro.test(res1)#reject H0 (不是normal)
ks.test(res1,mean(res1),sd(res1))# ??????H0 ???normal
qqnorm(res1, main="Normal Q-Q Plot of residual (IMA(1,1))");qqline(res1)#???端???離很???(亂???)-->?????????garch(證???1)
#檢??????不???要???garch(???residual)
McLeod.Li.test(y=res2, main="Mc.Leod.Li Test of residual (IMA(1,1))")#?????????garch(證???2)
#???res一次方
acf(res1)#???起來都不相???
pacf(res1)
#???res平方
acf(res1^2, main="Residual square ACF of IMA(1,1)")#步數??????相???
pacf(res1^2)#步數??????相???-->?????????garch(證???3)
eacf(res1^2)
#acf(??????)???MA；pacf(???數??????)???AR
#if?????????pacf??????數?????????acf?????????，???以是AR

###???置模???AR(1)
#要放mu???去估???
mod2 <- arima(diff(log(stock)), order=c(1, 0, 0), include.mean=T)
res2 <- residuals(mod2)
res_g1 <- res2
plot(res2, main="Residual Plot of ARI(1,1)")
acf(res2, main="Residual ACF of ARI(1,1)")
summary(mod2)
#Ljung box lag=2, 3, 21, 27,...
Box.test(res2, lag=5, type="Ljung-Box") #不??????->不相???
#檢???平???
hist(res2, main="Histogram of residual (ARI(1,1))")
t.test(res2)
#檢???normal
shapiro.test(res2)#reject H0 (不是normal)
ks.test(res2,mean(res2),sd(res2))# ??????H0 ???normal
qqnorm(res2, main="Normal Q-Q Plot of residual (ARI(1,1))");qqline(res2)#???端???離很???(亂???)-->?????????garch(證???1)
#檢??????不???要???garch(???residual)
McLeod.Li.test(y=res2, main="Mc.Leod.Li Test of residual (ARI(1,1))")#?????????garch(證???2)
#???res一次方
acf(res2)#???起來都不相???
pacf(res2)
#???res平方
acf(res2^2, main="Residual square ACF of ARI(1,1)")#步數??????相???
pacf(res2^2)#步數??????相???-->?????????garch(證???3)
eacf(res2^2)
#acf(??????)???MA；pacf(???數??????)???AR
#if?????????pacf??????數?????????acf?????????，???以是AR
#acf(??????)???MA；pacf(???數??????)???AR
#if?????????pacf??????數?????????acf?????????，???以是AR


#Causality (ccf)比???

res_g2 <- read.csv("D:/meeting/NCKU/y_junior/????????????/Final Project/game2/res_g2.csv", header=T)
res_g1
tt <- read.csv("D:/meeting/NCKU/y_junior/????????????/Final Project/game2/week.csv", header=T)
resy = res_g1
resx = res_g2$x
tsy  = stock$price
tsx  = tt$price

plot(resy,type='l')
plot(resx,type='l')
plot(tsx,type='l',main='stock price of Blizzard ')
plot(tsy,type='l',main='stock price of Grinding Gear Games ')


ccf(resx,(log(tsy)))
ccf(resy,((tsx^-0.4)/-0.4))

ccf(resx,((tsx^-0.4)/-0.4))
ccf(resy,(log(tsy)))


ccf(resx,(tsy))
ccf(resy,(tsx))

ccf(resx,(tsx))
ccf(resy,(tsy))
ccf(tsy,tsx)
ccf(resx,resy, main = "Grinding Gear Games & Blizzard")
